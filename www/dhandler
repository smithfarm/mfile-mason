<%flags>
  inherit => undef
</%flags>

<%once>
  use mfile_init;
  use Logger::Syslog;

  mfile_init::LoadGlobal();
  my $Global = $mfile_init::Global;
  info("dhandler: globals loaded");
</%once>

<%init>
  use mfile_init;
  debug("Entering dhandler");
  if (not exists $Global->{'mfilevernum'}) {
     error("Globals not loaded properly");
  }
</%init>

<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <title>MFILE <% $Global->{'mfilevernum'} %></title>
   <link rel="stylesheet" type="text/css" href="/css/start.css" />
</head>

<body>
<script><& /js/jquery.js &></script>
<script><& /js/01init.js &></script>
<script><& /js/03cook.js &></script>
<script><& /js/04logo.js &></script>
<script><& /js/09rest.js &></script>

<!-- foobar is a hidden field in the DOM -->
<input type="hidden" id="foobar" value="" />

<div class="abovebox" id="title">
<div class="subbox" style="font-size: 24px; width: 80px"><strong>MFILE</strong></div>
<div class="subbox" id="versionbox" style="width: 50px"><% $Global->{'mfilevernum'} %></div>
<div class="subbox" style="width: 480px"></div>
<div class="subbox" id="userid"></div>
</div>

<div class="boxbot" id="header">
   <span class="subbox" id="topmesg">If application is
   unresponsive, make sure browser window is active and press 'TAB'</span>
</div>

<div class="mainarea" id="mainarea">
<script>
   MFILE.uid = "<% $Global->{'username'} %>";
   console.log("MFILE.uid === '"+MFILE.uid+"'");
</script>
% debug("Global hash username '". $Global->{'username'} . "', USERID " . $Global->{'userid'});
% if ( (not exists $Global->{'username'}) or (length $Global->{'username'} == 0)) {
%    debug("dhandler: User not logged in");
%    $m->comp( '/html/login-dialog.mas' );
% } else {
%    debug("dhandler: User is " . $Global->{'username'});
%    $m->comp( '/html/main-menu.mas' );
% }
</div>

<div class="single" id="bothelp">
</div>

<div class="boxbot" id="result">
</div>

<div class="dbstatus" id="dbstatus">
<% $Global->{'dbvernum'} %>
</div>

</body>
</html>

